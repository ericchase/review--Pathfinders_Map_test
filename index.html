<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pathfinders Interactive Map</title>

    <!-- Link to Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Your custom CSS -->
    <link rel="stylesheet" href="style.css" />

    <style>
      /* Adjust the title's margin and padding */
      h1 {
        margin: 10px; /* Adjust the outer space */
        padding: 0; /* Remove internal space */
        text-align: center; /* Optional: Center-align the title */
      }

      /* Style for the legend */
      #legend {
        position: fixed;
        top: 150px; /* Adjusted to give more space from the top */
        left: 5%;
        background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent black background */
        padding: 10px;
        border-radius: 10px;
        color: white;
        font-size: 14px;
        z-index: 1000;
        max-width: 250px;
      }

      #legend h3 {
        margin: 0;
        padding-bottom: 10px;
      }

      #legend ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      #legend li {
        margin-bottom: 8px;
      }

      .legend-item,
      .legend-line {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 10px;
        vertical-align: middle;
      }

      .legend-line {
        width: 30px;
        height: 5px;
      }
    </style>

    <style>
      html,
      body {
        overflow: hidden;
        width: 100%;
        height: 100%;
      }

      #body-flex-column {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
      }
      #map-container {
        flex: 1;
        overflow: hidden;
        border-top: 3px solid #333; /* Add a border at the top of the map for style */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Add subtle shadow around the map */
      }

      /* Style for the map container */
      #map {
        height: 100%;
        width: 100%;
        translate: 3390px 3180px;
        overflow: unset !important;
      }
      #ruler-container {
        /* border-bottom: 2px solid #fff; */
        line-height: 0;
        pointer-events: none;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <div id="body-flex-column">
      <h1>Pathfinders Interactive Map</h1>
      <div id="ruler-container"><img src="coord-top.jpg" /></div>
      <!-- Div for the map -->
      <div id="map-container">
        <div id="map"></div>
      </div>
    </div>

    <div id="legend">
      <h3>Map Legend</h3>
      <ul>
        <!-- Friendly Territory -->
        <li>
          <span class="legend-item" style="background-color: blue; opacity: 0.3"></span>
          Friendly Territory
        </li>

        <!-- Unconfirmed Territory -->
        <li>
          <span class="legend-item" style="background-color: grey; opacity: 0.3"></span>
          Unconfirmed Territory
        </li>

        <!-- Hostile Territory -->
        <li>
          <span class="legend-item" style="background-color: red; opacity: 0.3"></span>
          Hostile Territory
        </li>

        <!-- Objectives -->
        <li>
          <span class="legend-item" style="background-color: blue; border-radius: 50%"></span>
          Objective
        </li>
        <li>
          <span class="legend-item" style="background-color: orange; border-radius: 50%"></span>
          Objective
        </li>
        <li>
          <span class="legend-item" style="background-color: red; border-radius: 50%"></span>
          Objective
        </li>

        <!-- Patrol Routes -->
        <li>
          <span class="legend-line" style="background-color: blue"></span>
          Combat Patrol Route
        </li>
        <li>
          <span class="legend-line" style="background-color: orange"></span>
          Stealth Patrol Route
        </li>
        <li>
          <span class="legend-line" style="background-color: red"></span>
          Enemy Patrol Route
        </li>
      </ul>
    </div>

    <!-- Link to Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
      // Initialize the map
      const map = L.map('map', {
        crs: L.CRS.Simple,
        zoomControl: false, // Disable zoom control
      }).setView([0, 0], 1);

      // Disable zoom and dragging
      map.scrollWheelZoom.disable();
      map.touchZoom.disable();
      map.doubleClickZoom.disable();
      map.boxZoom.disable();
      map.dragging.disable();

      // Define the map's image bounds
      const bounds = [
        [0, 0],
        [8000, 8000],
      ];

      // Add the map image
      const image = L.imageOverlay('everon-map.jpg', bounds).addTo(map);
      map.fitBounds(bounds);
      map.setMaxBounds(bounds);

      // Get reference to the ruler container
      const rulerContainer = document.getElementById('ruler-container');

      // Function to update the ruler width with map zoom
      function updateRulerWidth() {
        const zoomLevel = map.getZoom();
        const scaleFactor = Math.pow(2, zoomLevel); // Adjust zoom level scaling
        const mapWidthAtZoom = 8000 * scaleFactor; // Calculate the width of the map at the current zoom level
        //rulerContainer.style.backgroundSize = `${mapWidthAtZoom}px 56px`; // Set the ruler's width to match map width
      }

      // Function to update the ruler position and width
      function updateRulerPosition() {
        // Get the zoom level and corresponding scale factor
        const zoomLevel = map.getZoom();
        const scaleFactor = Math.pow(2, zoomLevel); // Zoom scale factor

        // Calculate the map's width at the current zoom level
        const mapWidthAtZoom = 8000 * scaleFactor; // Base width of 8000px for the map image

        // Set the ruler's background size to match the map's current width
        //rulerContainer.style.backgroundSize = `${mapWidthAtZoom}px 56px`; // Width adjusted for zoom

        // Calculate the offset to keep the ruler horizontally centered
        const offsetX = (mapWidthAtZoom - map.getSize().x) / 2; // Centering based on zoom level

        // Align the ruler container to the center of the map's image, horizontally
        //rulerContainer.style.left = `${-offsetX}px`;

        // Keep the vertical position fixed at the top of the viewport
        //rulerContainer.style.top = '0';
      }

      // Attach events to update ruler position/width
      map.on('moveend', () => {
        updateRulerPosition();
      });

      map.on('zoomend', () => {
        updateRulerPosition();
      });

      // Initialize ruler adjustments
      updateRulerPosition();
    </script>
  </body>
</html>
